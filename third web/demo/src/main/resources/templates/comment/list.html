<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Comment management</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css"><!-- layui的核心css -->
    <script src="/static/layui/layui.all.js"></script><!--模块化加载layui的核心js -->
    <script src="/static/js/jquery-3.5.1.min.js"></script>
    <script src="/static/js/echarts.min.js"></script>
    <style type="text/css">
        .layui-table-cell {
            height: auto;
            white-space: normal;
            text-align: center;
        }
    </style>
</head>
<body style="margin: 10px;">
    <fieldset class="layui-elem-field">
        <legend>Comment management</legend>
        <div class="layui-field-box">
            <table id="tb" lay-filter="table"></table>
        </div>
    </fieldset>
    <script type="text/html" id="bar">
        <div class="layui-btn-container">
            <a class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">Delete</a>
        </div>
    </script>
    <script>
        //从url中获取携带的参数
        var rid = location.search.split("=");
        function reload() {
            var table = layui.table;
            table.reload('tb', {
            });
        }
        $(document).ready(
            function() {
                var form = layui.form;
                form.render();
                var table = layui.table;
                table.render({
                    id : 'tb',
                    url : '/comment/commentListByRid',
                    elem : '#tb',
                    method : 'post',
                    cellMinWidth : 150,
                    where : {
                        rid:rid[1],
                    },
                    cols : [ [ //标题栏
                        {
                            field : 'id',
                            width : 100,
                            title : 'ID'
                        }, {
                            field : 'content',
                            title : 'Content',
                            width : 200
                        }, {
                            field : 'commentUserName',
                            width : 100,
                            title : 'Nickname'

                        },{
                            title : 'Operation',
                            toolbar : '#bar'
                        } ] ],
                    page : false
                });
                //监听工具条
                table.on('tool(table)', function(obj) { //
                    var data = obj.data; //获得当前行数据
                    var layEvent = obj.event; //获得 lay-event 对应的值
                    if (layEvent == 'delete') {
                        layer.confirm('请问是否确定删除？', function() {
                            var url = '/comment/deleteComment';
                            var requestData = {
                                id : data.id,
                            };
                            var index = layer.load();
                            $.post(url, requestData, function(res) {
                                if (res.code == 0) {
                                    layer.close(index);
                                    layer.msg('操作成功');
                                    reload();
                                } else {
                                    layer.alert(res.msg);
                                }
                            }, 'json').always(function() {
                                //关闭弹层
                                layer.close(index);
                            });
                        });
                    }
                });

            });
    </script>

</body>
</html>